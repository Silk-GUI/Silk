<html>

<head>
  <title>App Manager</title>
  <style>
    body {
      font-family: sans-serif;
      margin-top: 80px;
      margin-bottom: 60px;
    }
    button {
      font-size: 16px;
      color: white;
      box-sizing: border-box;
      height: 40px;
      padding: 10px;
      background-color: purple;
      border: none;
      cursor: pointer;
    }
    #manager h2 {
      font-weight: 300;
      color: #FFF;
      background-color: #800080;
      position: absolute;
      top: 0px;
      left: 0px;
      margin: 0px;
      width: 100%;
      padding: 15px;
      box-sizing: border-box;
    }
    #manager li {
      list-style: none;
      padding: 15px;
      margin-bottom: 5px;
      background-color: #cc90f2;
      width: 300px;
      position: relative;
    }
    #manager li button {
      position: absolute;
      right: 0px;
      top: 0px;
      box-sizing: border-box;
      height: 48px;
      border: 0px;
      background-color: #800080;
      color: #FFF;
      font-size: 16px;
    }
    #install {
      position: fixed;
      bottom: 0px;
      left: 0px;
      width: 100%;
      margin-bottom: 0px;
      background-color: purple;
      height: 40px;
    }
    #install input[type="text"] {
      box-sizing: border-box;
      width: 100%;
      padding-right: 80px;
      height: 40px;
      font-size: 16px;
      padding: 10px;
      border: 2px solid #800080;
    }
    #install input[type="submit"] {
      position: fixed;
      right: 0px;
      bottom: 0px;
      height: 40px;
      box-sizing: border-box;
      display: block;
      padding: 10px;
      background-color: #800080;
      border: 0px;
      color: #FFF;
      font-size: 16px;
      width: 80px;
      cursor: pointer;
    }
    #install input[type="submit"]:hover {
      background-color: #a71ba7;
    }
    #install input[type="text"]:focus {
      outline: none;
    }
    #status {
      position: fixed;
      bottom: 40px;
      left: 0px;
      width: 100%;
      box-sizing: border-box;
      height: 40px;
      padding-top: 12px;
      font-size: 16px;
      background-color: rgba(255, 255, 255, 0.5);
      text-align: center;
    }
    #status .app {
      color: green;
    }
  </style>
</head>

<body>
  <div id="manager">
    <h2>Your Apps</h2>
    <ul>
      <li v-repeat="apps"><span>{{title}}</span> 
        <button v-on="click : remove(this)">&times;</button>
      </li>
    </ul>
  </div>
  <button id="reload">Reload</button>
  <form id="install">
    <input type="text" placeholder="Github-user-name/repository">
    <input type="submit" value="Install">
  </form>
  <div id="status"><span class="progress"></span>  <span class="app"></span>
  </div>

  <script src="/bc/vue"></script>
  <script src="/bc/jquery"></script>
  <script src="/api.js"></script>
  <script src="/js/call.js"></script>
  <script>
    var apps = [],
      manager;
    $("body").ready(function () {
      manager = new Vue({
        el: "#manager",
        data: {
          apps: apps
        },
        methods: {
          remove: function (app) {
            var silkApps = ["fileExplorer", "terminal", "textEditor", "tunnelclient", "appManager", "app-defualts"];
            if (silkApps.indexOf(app.folder) === -1) {

              $("#status .app").text(app.name);
              $("#status").css("display", "block");


              methods.listen("apps/remove", {
                folder: app.name,
                name: app.title
              }, function (err, message) {
                if (err) {
                  alert(err);
                  $("#status").css("display", "none");
                  $("#status .progress").text("");
                  return;
                }

                $("#status .progress").text(message);

                if (message === " ") {
                  $("#status .progress").text("Removed");
                  setTimeout(function () {
                    $("#status").css("display", "none");
                    location.reload();
                  }, 500);
                }

              });

              console.dir(app);
            }
          }
        }
      });
      methods.listen("apps/list", {}, function (error, data) {
        if (error) {
          alert(error);
        }
        var newData = {
          apps: data
        }
        manager.$data = newData;

      });
    });

    $("#reload").click(function () {
      location.reload();
    });

    $("#install").submit(function (e) {
      e.preventDefault();

      var url = $("#install input[type='text']").val().trim();
      $("#install input[type='text]").val("");
      $("#status").css("display", "block");

      $("#status .app").text(url.split("/")[1]);
      methods.listen("apps/install", {
        "url": url
      }, function (err, message) {
        if (err) {
          alert(err);
          $("#status").css("display", "none");
          $("#status .progress").text("");
          return;
        }
        $("#status .progress").text(message);
        if (message === " ") {
          $("#status .progress").text("Installed ");
          setTimeout(function () {
            $("#status").css("display", "none");
            location.reload();
          }, 500)
        }


      })
    });
  </script>
</body>

</html>